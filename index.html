<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Finance Dashboard ‚Äî Enhanced Dashboard</title>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <style>
      * { margin:0; padding:0; box-sizing:border-box; }
      :root{
        --bg: linear-gradient(135deg,#667eea,#764ba2);
        --card:#1e1e2f;
        --muted:#cbd5e1;
        --accent:#2b49cd;
        --success:#17f50c;
        --danger:#fb0404;
        --glass: rgba(255, 255, 255, 0.04);
        --radius:12px;
      }
      body{
        font-family: Inter, system-ui, sans-serif;
        min-height:100vh;
        background:var(--bg);
        color:#fff;
        padding-bottom:40px;
      }

      /* Header */
      .header{
        background:var(--glass);
        margin:16px;
        padding:14px 18px;
        border-radius:14px;
        backdrop-filter: blur(8px);
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:12px;
      }
      .logo{display:flex; align-items:center; gap:8px; font-weight:700;}
      .balance-display { text-align:center; padding:8px 14px; background: rgba(255,255,255,0.03); border-radius:10px; }
      .balance-amount { font-weight:700; color:var(--success); }

      .btn{ background:var(--accent); border:none; padding:8px 12px; border-radius:10px; cursor:pointer; color:#fff; }
      .btn-sm{ padding:6px 10px; font-size:0.9rem; }

      /* Tabs */
      .nav-tabs{ display:flex; gap:8px; padding:10px 18px; overflow:auto; margin:0 16px; }
      .nav-tab{ background:rgba(255,255,255,0.03); color:var(--muted); border:none; padding:8px 12px; border-radius:10px; cursor:pointer; display:flex; gap:8px; align-items:center;}
      .nav-tab.active{ background:var(--accent); color:#fff; box-shadow:0 6px 18px rgba(0,0,0,0.35); transform:translateY(-2px); }

      /* Container */
      .container{ max-width:1200px; margin:18px auto; padding:0 16px; }

      /* Dashboard grid & cards */
      .dashboard-grid{ display:grid; grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); gap:16px; margin-bottom:18px; }
      .card{ background:var(--card); padding:14px; border-radius:12px; box-shadow: 0 8px 30px rgba(0,0,0,0.35); }
      .stat-card { text-align:center; }
      .stat-value{ font-size:1.6rem; font-weight:700; margin-bottom:6px; }
      .stat-label{ color:var(--muted); font-size:0.9rem; }

      /* Charts */
      .chart-container{ height:260px; margin-top:8px; }

      /* Transactions table */
      .transactions-table{ width:100%; border-collapse:collapse; margin-top:8px; }
      .transactions-table th, .transactions-table td{ padding:10px 8px; text-align:left; border-bottom:1px solid rgba(255,255,255,0.04); color:var(--muted); font-size:0.95rem; }
      .transactions-table td .amount { font-weight:700; color:#fff; }
      .transaction-income{ color:var(--success); }
      .transaction-expense{ color:var(--danger); }

      /* Recent Transactions list */
      .recent-list{ display:flex; flex-direction:column; gap:8px; margin-top:8px; }
      .recent-item{ display:flex; align-items:center; gap:12px; padding:8px; border-radius:10px; background: rgba(255,255,255,0.02); }
      .cat-icon{ width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.05rem; flex-shrink:0; background:rgba(255,255,255,0.03); }
      .recent-info{ flex:1; }
      .recent-title{ font-weight:600; margin-bottom:4px; }
      .recent-meta{ color:var(--muted); font-size:0.9rem; }

      /* Modal */
      .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.6); z-index:999; }
      .modal.active{ display:flex; }
      .modal-content{ width:420px; max-width:94%; background:#11111a; padding:16px; border-radius:12px; }
      .modal-content form{ display:flex; flex-direction:column; gap:8px; }
      .form-input, .form-select{ padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff; }

      /* action buttons */
      .action-btn{ background:none; border:none; cursor:pointer; color:var(--muted); padding:6px; border-radius:8px; }
      .action-btn:hover{ background: rgba(255,255,255,0.02); color:#fff; }

      @media (max-width:640px){
        .header{ flex-direction:column; align-items:stretch; gap:12px;}
        .nav-tabs{ padding-left:8px; padding-right:8px; }
      }
    </style>
  </head>

  <body>
    <header class="header">
      <div class="logo">
        <span>üí∞</span>
        <div>Finance Dashboard</div>
      </div>

      <div class="balance-display">
        <div style="font-size:0.85rem; color:var(--muted)">Total Balance</div>
        <div class="balance-amount" id="totalBalance">‚Çπ0</div>
      </div>

      <div style="display:flex; gap:8px; align-items:center;">
        <button id="openModal" class="btn btn-sm">‚ûï Add Transaction</button>
      </div>
    </header>

    <nav class="nav-tabs" id="navTabs">
      <button class="nav-tab active" data-tab="dashboard">üè† Dashboard</button>
      <button class="nav-tab" data-tab="transactions">üí≥ Transactions</button>
      <button class="nav-tab" data-tab="budget">üìä Budget</button>
      <button class="nav-tab" data-tab="savings">üéØ Savings</button>
      <button class="nav-tab" data-tab="bills">üìÖ Bills</button>
      <button class="nav-tab" data-tab="investments">üìà Investments</button>
      <button class="nav-tab" data-tab="reports">üìã Reports</button>
      <button class="nav-tab" data-tab="settings">‚öôÔ∏è Settings</button>
    </nav>

    <main class="container">
      <!-- DASHBOARD -->
      <section id="dashboard-tab" class="tab-content" style="display:block;">
        <div class="dashboard-grid">
          <div class="card stat-card">
            <div class="stat-value transaction-income" id="totalIncome">‚Çπ0</div>
            <div class="stat-label">Total Income</div>
          </div>
          <div class="card stat-card">
            <div class="stat-value transaction-expense" id="totalExpenses">‚Çπ0</div>
            <div class="stat-label">Total Expenses</div>
          </div>
          <div class="card stat-card">
            <div class="stat-value" id="totalSavings" style="color:var(--success)">‚Çπ0</div>
            <div class="stat-label">Total Savings</div>
          </div>
          <div class="card stat-card">
            <div class="stat-value" id="monthlyBudget" style="color:var(--muted)">‚Çπ0</div>
            <div class="stat-label">Monthly Budget</div>
          </div>
        </div>

        <div class="dashboard-grid">
          <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <h3 style="font-size:1rem;">üìä Monthly Overview</h3>
            </div>
            <div class="chart-container">
              <canvas id="monthlyChart"></canvas>
            </div>
          </div>

          <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <h3 style="font-size:1rem;">ü•ß Expense Categories</h3>
            </div>
            <div class="chart-container">
              <canvas id="categoryChart"></canvas>
            </div>
          </div>
        </div>

        <div class="dashboard-grid">
          <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <h3 style="font-size:1rem;">üí∏ Recent Transactions</h3>
              <button class="btn btn-sm" onclick="switchTab('transactions')">View All</button>
            </div>
            <div id="recentTransactions" class="recent-list"></div>
          </div>

          <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <h3 style="font-size:1rem;">üìÖ Upcoming Bills</h3>
              <button class="btn btn-sm" onclick="switchTab('bills')">Manage</button>
            </div>
            <div id="upcomingBills" style="margin-top:8px; color:var(--muted);">No upcoming bills</div>
          </div>
        </div>
      </section>

      <!-- TRANSACTIONS -->
      <section id="transactions-tab" class="tab-content" style="display:none;">
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Recent Transactions</h2>
            <div style="display:flex; gap:8px; align-items:center;">
              <select id="categoryFilter" class="form-select" style="padding:6px 8px; border-radius:8px; background:transparent; color:#fff; border:1px solid rgba(255,255,255,0.04);">
                <option value="">All categories</option>
                <option value="salary">Salary</option>
                <option value="food">Food</option>
                <option value="rent">Rent</option>
                <option value="travel">Travel</option>
                <option value="shopping">Shopping</option>
                <option value="entertainment">Entertainment</option>
                <option value="other">Other</option>
              </select>
              <button id="addTransactionBtn" class="btn btn-sm">Add</button>
            </div>
          </div>

          <table class="transactions-table" style="margin-top:12px;">
            <thead>
              <tr>
                <th>Title</th>
                <th>Amount</th>
                <th>Type</th>
                <th>Category</th>
                <th>Date</th>
                <th style="width:110px;text-align:right;">Actions</th>
              </tr>
            </thead>
            <tbody id="transactionsTableBody"></tbody>
          </table>
        </div>
      </section>

      <!-- simple placeholders for other tabs -->
      <section id="budget-tab" class="tab-content" style="display:none;">
        <div class="card"><h3>Budget ‚Äî coming soon</h3></div>
      </section>

      <section id="savings-tab" class="tab-content" style="display:none;">
        <div class="card"><h3>Savings ‚Äî coming soon</h3></div>
      </section>

      <section id="bills-tab" class="tab-content" style="display:none;">
        <div class="card"><h3>Bills & Reminders ‚Äî coming soon</h3></div>
      </section>

      <section id="investments-tab" class="tab-content" style="display:none;">
        <div class="card"><h3>Investments ‚Äî coming soon</h3></div>
      </section>

      <section id="reports-tab" class="tab-content" style="display:none;">
        <div class="card"><h3>Reports ‚Äî coming soon</h3></div>
      </section>

      <section id="settings-tab" class="tab-content" style="display:none;">
        <div class="card"><h3>Settings ‚Äî coming soon</h3></div>
      </section>
    </main>

    <!-- Modal for add / edit transaction -->
    <div id="transactionModal" class="modal" aria-hidden="true">
      <div class="modal-content">
        <h3 id="modalTitle">Add Transaction</h3>
        <form id="transactionForm">
          <input type="text" id="tTitle" class="form-input" placeholder="Title (e.g., Salary)" required />
          <input type="number" id="tAmount" class="form-input" placeholder="Amount" step="0.01" required />
          <select id="tType" class="form-select" required>
            <option value="income">Income</option>
            <option value="expense">Expense</option>
          </select>
          <input type="text" id="tCategory" class="form-input" placeholder="Category (e.g., Food)" />
          <input type="date" id="tDate" class="form-input" required />
          <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:6px;">
            <button type="button" class="btn" id="cancelBtn">Cancel</button>
            <button type="submit" class="btn btn-sm" id="saveBtn">Save</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // -------------------------
      // Simple categories -> icon map
      // -------------------------
      const categoryIcons = {
        salary: "üíº",
        food: "üçî",
        rent: "üè†",
        travel: "‚úàÔ∏è",
        shopping: "üõçÔ∏è",
        entertainment: "üé¨",
        other: "üì¶",
      };

      // -------------------------
      // App state
      // -------------------------
      let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
      let editIndex = null;

      // DOM refs
      const tabs = document.querySelectorAll('.nav-tab');
      const tabContents = document.querySelectorAll('.tab-content');
      const openModalBtn = document.getElementById('openModal');
      const addTransactionBtn = document.getElementById('addTransactionBtn');
      const transactionModal = document.getElementById('transactionModal');
      const transactionForm = document.getElementById('transactionForm');
      const transactionsTableBody = document.getElementById('transactionsTableBody');
      const recentTransactionsEl = document.getElementById('recentTransactions');
      const upcomingBillsEl = document.getElementById('upcomingBills');
      const totalBalanceEl = document.getElementById('totalBalance');
      const totalIncomeEl = document.getElementById('totalIncome');
      const totalExpensesEl = document.getElementById('totalExpenses');
      const totalSavingsEl = document.getElementById('totalSavings');
      const monthlyBudgetEl = document.getElementById('monthlyBudget');
      const categoryFilter = document.getElementById('categoryFilter');

      // Charts
      let monthlyChart = null;
      let categoryChart = null;

      // -------------------------
      // Utility helpers
      // -------------------------
      function saveTransactions() {
        localStorage.setItem('transactions', JSON.stringify(transactions));
      }

      function formatCurrency(val){
        const n = Number(val) || 0;
        return '‚Çπ' + n.toLocaleString(undefined, {maximumFractionDigits:2});
      }

      function iconFor(cat){
        if(!cat) return categoryIcons.other;
        const key = String(cat).trim().toLowerCase();
        return categoryIcons[key] || categoryIcons.other;
      }

      // -------------------------
      // Tab switching
      // -------------------------
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelector('.nav-tab.active').classList.remove('active');
          tab.classList.add('active');
          switchTab(tab.dataset.tab);
        });
      });

      function switchTab(tabName){
        tabContents.forEach(tc => tc.style.display = 'none');
        const target = document.getElementById(tabName + '-tab');
        if(target) target.style.display = 'block';
        // if switching to dashboard, update charts
        if(tabName === 'dashboard') {
          updateDashboard();
        }
      }

      // -------------------------
      // Render transactions table + recent list
      // -------------------------
      function renderTransactions(){
        transactionsTableBody.innerHTML = '';
        const filter = categoryFilter.value?.toLowerCase() || '';
        transactions.forEach((t, i) => {
          if(filter && (t.category||'').toLowerCase() !== filter) return;
          const tr = document.createElement('tr');
          const amtClass = t.type === 'income' ? 'transaction-income' : 'transaction-expense';
          tr.innerHTML = `
            <td style="color:#fff;">${t.title || '‚Äî'}</td>
            <td><span class="amount ${amtClass}">${formatCurrency(t.amount)}</span></td>
            <td>${(t.type || '').charAt(0).toUpperCase() + (t.type||'').slice(1)}</td>
            <td>${t.category || 'Other'}</td>
            <td>${t.date || ''}</td>
            <td style="text-align:right;">
              <button class="action-btn edit-btn" data-index="${i}" title="Edit">‚úèÔ∏è</button>
              <button class="action-btn delete-btn" data-index="${i}" title="Delete">üóëÔ∏è</button>
            </td>
          `;
          transactionsTableBody.appendChild(tr);
        });
      }

      function renderRecentTransactions(){
        recentTransactionsEl.innerHTML = '';
        // show last 6 transactions in reverse chronological (by date if provided, else by order)
        const sorted = [...transactions].sort((a,b) => {
          if(a.date && b.date) return new Date(b.date) - new Date(a.date);
          return 0;
        }).slice(0,6);
        if(sorted.length === 0){
          recentTransactionsEl.innerHTML = '<div style="color:var(--muted)">No recent transactions</div>';
          return;
        }
        sorted.forEach((t,i) => {
          const item = document.createElement('div');
          item.className = 'recent-item';
          item.innerHTML = `
            <div class="cat-icon">${iconFor(t.category)}</div>
            <div class="recent-info">
              <div class="recent-title">${t.title || '‚Äî'} <span style="font-weight:600; margin-left:8px;" class="${t.type==='income'?'transaction-income':'transaction-expense'}">${formatCurrency(t.amount)}</span></div>
              <div class="recent-meta">${t.category || 'Other'} ‚Ä¢ ${t.date || ''}</div>
            </div>
            <div style="display:flex; gap:6px;">
              <button class="action-btn small-edit" data-title="${t.title||''}" data-index="${transactions.indexOf(t)}">‚úèÔ∏è</button>
              <button class="action-btn small-delete" data-index="${transactions.indexOf(t)}">üóëÔ∏è</button>
            </div>
          `;
          recentTransactionsEl.appendChild(item);
        });
      }

      // -------------------------
      // Dashboard totals & charts
      // -------------------------
      function updateDashboard(){
        // totals
        let totalIncome = 0, totalExpenses = 0;
        transactions.forEach(t => {
          const amt = Number(t.amount) || 0;
          if(t.type === 'income') totalIncome += amt;
          else totalExpenses += amt;
        });
        const totalBalance = totalIncome - totalExpenses;
        const totalSavings = totalBalance; // simple mapping for now

        totalIncomeEl.textContent = formatCurrency(totalIncome);
        totalExpensesEl.textContent = formatCurrency(totalExpenses);
        totalSavingsEl.textContent = formatCurrency(totalSavings);
        totalBalanceEl.textContent = formatCurrency(totalBalance);
        monthlyBudgetEl.textContent = formatCurrency(0); // placeholder

        // charts
        renderMonthlyChart();
        renderCategoryChart();

        // recent & upcoming
        renderRecentTransactions();
        renderUpcomingBills(); // placeholder (no bills implemented yet)
      }

      // Monthly chart aggregates (show recent 6 months)
      function renderMonthlyChart(){
        // aggregate amounts per month-year (use month of transaction date; income positive, expense negative for display)
        const map = {}; // key: YYYY-MM
        transactions.forEach(t => {
          if(!t.date) return;
          const d = new Date(t.date);
          if(isNaN(d)) return;
          const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
          const amt = Number(t.amount) || 0;
          map[key] = (map[key] || 0) + (t.type==='income' ? amt : -amt);
        });
        // pick last 6 months keys (ensure in chronological order)
        const now = new Date();
        const keys = [];
        for(let i=5;i>=0;i--){
          const dt = new Date(now.getFullYear(), now.getMonth()-i, 1);
          const key = `${dt.getFullYear()}-${String(dt.getMonth()+1).padStart(2,'0')}`;
          keys.push(key);
        }
        const labels = keys.map(k => {
          const [y,m] = k.split('-');
          return `${m}/${y.slice(-2)}`;
        });
        const data = keys.map(k => Math.round((map[k] || 0) * 100)/100);

        // create/update chart
        const ctx = document.getElementById('monthlyChart').getContext('2d');
        if(monthlyChart) {
          monthlyChart.data.labels = labels;
          monthlyChart.data.datasets[0].data = data;
          monthlyChart.update();
        } else {
          monthlyChart = new Chart(ctx, {
            type: 'line',
            data: {
              labels,
              datasets: [{
                label: 'Net cashflow',
                data,
                fill: true,
                tension: 0.35,
                borderWidth: 2,
                pointRadius: 3,
              }]
            },
            options: {
              responsive:true,
              maintainAspectRatio:false,
              plugins:{
                legend:{ display:false },
                tooltip:{ callbacks: { label: ctx => formatCurrency(ctx.raw) } }
              },
              scales:{
                x: { grid: { display:false }, ticks:{ color:'#cbd5e1' } },
                y: { ticks:{ color:'#cbd5e1', callback: v => '‚Çπ'+v }, grid:{ color:'transparent' } }
              }
            }
          });
        }
      }

      // Category chart: show expense categories breakdown
      function renderCategoryChart(){
        const counts = {}; // amount per category (only expenses)
        transactions.forEach(t=>{
          if(t.type !== 'expense') return;
          const c = (t.category || 'Other').toLowerCase();
          counts[c] = (counts[c] || 0) + (Number(t.amount)||0);
        });
        const labels = Object.keys(counts);
        const dataVals = labels.map(l => Math.round(counts[l]*100)/100);

        const ctx = document.getElementById('categoryChart').getContext('2d');
        if(categoryChart){
          categoryChart.data.labels = labels;
          categoryChart.data.datasets[0].data = dataVals;
          categoryChart.update();
        } else {
          categoryChart = new Chart(ctx, {
            type: 'pie',
            data: {
              labels,
              datasets:[{ data:dataVals }]
            },
            options:{
              responsive:true,
              maintainAspectRatio:false,
              plugins:{ legend:{ position:'bottom', labels:{ color:'#cbd5e1' } } }
            }
          });
        }
      }

      // Upcoming bills placeholder
      function renderUpcomingBills(){
        // we don't yet have bills stored ‚Äî placeholder logic
        upcomingBillsEl.textContent = 'No upcoming bills';
      }

      // -------------------------
      // Add / Edit / Delete transactions
      // -------------------------
      function openModal(forEdit=false){
        transactionModal.classList.add('active');
        document.getElementById('modalTitle').textContent = forEdit ? 'Edit Transaction' : 'Add Transaction';
      }
      function closeModal(){
        transactionModal.classList.remove('active');
        transactionForm.reset();
        editIndex = null;
      }

      openModalBtn.addEventListener('click', () => { editIndex=null; openModal(false); });
      addTransactionBtn.addEventListener('click', () => { editIndex=null; openModal(false); });

      // table actions (edit/delete)
      transactionsTableBody.addEventListener('click', (e) => {
        const del = e.target.closest('.delete-btn');
        const edit = e.target.closest('.edit-btn');
        if(del){
          const idx = Number(del.dataset.index);
          if(!isNaN(idx)) {
            if(confirm('Delete this transaction?')) {
              transactions.splice(idx,1);
              saveTransactions();
              renderAll();
            }
          }
          return;
        }
        if(edit){
          const idx = Number(edit.dataset.index);
          if(!isNaN(idx)) {
            editIndex = idx;
            const t = transactions[idx];
            document.getElementById('tTitle').value = t.title || '';
            document.getElementById('tAmount').value = t.amount || '';
            document.getElementById('tType').value = t.type || 'expense';
            document.getElementById('tCategory').value = t.category || '';
            document.getElementById('tDate').value = t.date || '';
            openModal(true);
          }
        }
      });

      // recent list small buttons
      recentTransactionsEl.addEventListener('click', (e) => {
        const d = e.target.closest('.small-delete');
        const ed = e.target.closest('.small-edit');
        if(d){
          const idx = Number(d.dataset.index);
          if(!isNaN(idx) && confirm('Delete this transaction?')){
            transactions.splice(idx,1);
            saveTransactions();
            renderAll();
          }
        }
        if(ed){
          const idx = Number(ed.dataset.index);
          if(!isNaN(idx)){
            editIndex = idx;
            const t = transactions[idx];
            document.getElementById('tTitle').value = t.title || '';
            document.getElementById('tAmount').value = t.amount || '';
            document.getElementById('tType').value = t.type || 'expense';
            document.getElementById('tCategory').value = t.category || '';
            document.getElementById('tDate').value = t.date || '';
            openModal(true);
          }
        }
      });

      // form submit
      transactionForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const title = document.getElementById('tTitle').value.trim();
        const amount = parseFloat(document.getElementById('tAmount').value) || 0;
        const type = document.getElementById('tType').value;
        const category = document.getElementById('tCategory').value.trim();
        const date = document.getElementById('tDate').value;

        const tx = { title, amount, type, category, date };

        if(editIndex !== null && !isNaN(editIndex)){
          transactions[editIndex] = tx;
        } else {
          transactions.push(tx);
        }
        saveTransactions();
        closeModal();
        renderAll();
        switchTab('dashboard');
      });

      document.getElementById('cancelBtn').addEventListener('click', (e)=>{ e.preventDefault(); closeModal(); });

      // close modal when clicking outside content
      transactionModal.addEventListener('click', (e)=>{ if(e.target === transactionModal) closeModal(); });

      // category filter change
      categoryFilter.addEventListener('change', ()=> renderTransactions());

      // -------------------------
      // Initial render & helper
      // -------------------------
      function renderAll(){
        renderTransactions();
        updateDashboard();
      }

      // Initial load
      renderAll();

      // Expose switchTab globally (used by buttons in markup)
      window.switchTab = switchTab;
    </script>
  </body>
</html>
